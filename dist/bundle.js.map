{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/app.js","src/bit_stream.js","src/bitmap.js","src/buffer_stream.js","src/room.js","src/scumm.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","const Scumm = require('./scumm');\nconst Bitmap = require('./bitmap');\nconst Room = require('./room');\nconst BufferStream = require('./buffer_stream');\nconst BitStream = require('./bit_stream');\n\nconst INDEX_FILE = 'monkey2.000';\nconst BUNDLE_FILE = 'monkey2.001';\n// const INDEX_FILE = 'mi2demo.000';\n// const BUNDLE_FILE = 'mi2demo.001';\n\nclass App {\n  constructor() {\n    console.log('App');\n\n    this.files = [];\n    this.roomNames = [];\n    this.roomOffsets = [];\n    this.roomBlockOffsets = [];\n    this.rooms = [];\n\n    let canvas = document.createElement('canvas');\n    canvas.width = 320;\n    canvas.height = 200;\n    canvas.style.backgroundColor = 'lightgray';\n    // canvas.style.transformOrigin = '0 0';\n    // canvas.style.transform = 'scale(4)';\n    document.body.appendChild(canvas);\n\n    this.canvas = canvas;\n\n    this.initEventListeners();\n  }\n\n  decode(buffer, enc=0) {\n    let temp = new Uint8Array(buffer);\n    for (var i = 0; i < temp.length; i++) {\n      temp[i] = temp[i] ^ enc;\n    }\n    return temp.buffer;\n  }\n\n  getBlockTypeName(uint32) {\n    return String.fromCharCode(\n      (uint32 & 0xff),\n      ((uint32 >> 8) & 0xff),\n      ((uint32 >> 16) & 0xff),\n      ((uint32 >> 24) & 0xff)\n    );\n  }\n\n  parseIndex() {\n    if (!this.files[INDEX_FILE]) return;\n    let stream = new BufferStream(this.files[INDEX_FILE]);\n\n    while (stream.offset < stream.length) {\n      let type = stream.getUint32LE();\n      let size = stream.getUint32();\n      let name = this.getBlockTypeName(type);\n\n      if (name == 'RNAM') { // Room names table\n        while (1) {\n          let roomno = stream.getUint8();\n          if (roomno == 0) break;\n\n          let bytes = stream.getBytes(9);\n          this.roomNames[roomno] = bytes.reduce((accumulator, currentValue) => {\n            return accumulator + (currentValue != 0xff ? String.fromCharCode(currentValue ^ 0xff) : '');\n          }, '');\n        }\n        console.log(this.roomNames);\n      // }\n      // else if (name == 'DROO') {\n      //   let numitems = stream.getUint16LE();\n      //   let roomNos = stream.getBytes(, numitems);\n      //\n      //   let roomOffsets = [];\n      //   for (var i = 0; i < numitems; i++) {\n      //     let offs = stream.getUint32LE();\n      //     roomOffsets[i] = offs;\n      //   }\n      } else {\n        stream.getBytes(size - 8);\n      }\n    }\n  }\n\n  getBundleStream() {\n    let filename = BUNDLE_FILE;\n    if (!this.files[filename]) return;\n    let stream = new BufferStream(this.files[filename]);\n    return stream;\n  }\n\n  readBlockHead(stream) {\n    let type = stream.getUint32LE();\n    let size = stream.getUint32();\n    let name = this.getBlockTypeName(type);\n    return { name: name, type: type, size: size };\n  }\n\n  drawPixel(pixels, x, y, r, g, b) {\n    let index = (y * 320 + x) * 4;\n    pixels[index+0] = r;\n    pixels[index+1] = g;\n    pixels[index+2] = b;\n    pixels[index+3] = 255;\n    // console.log('pixel', x, y, r, g, b);\n  }\n\n  decompressStrip(stream, palette) {\n    console.log('decoding...');\n\n    let ctx = this.canvas.getContext('2d');\n    let imageData = ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\n    let pixels = imageData.data;\n    let x = 0, y = 0;\n\n    let code = stream.getUint8();\n    let shift = code % 10;\n    let mask = 0xff >> (8 - shift);\n\n    let bitstream = new BitStream(stream);\n\n    if (code >= 0x40 && code <= 0x44) {\n      console.log('Method B Horizontal', code, shift);\n\n      let color = stream.getUint8();\n      console.log(color.toString(2));\n      console.log('color', color, palette[color*3], palette[color*3+1], palette[color*3+2]);\n      stream.backup();\n      // bitstream.read(8);\n      let s = '';\n      for (var i = 0; i < 8; i++) {\n        s += bitstream.read();\n      }\n      console.log(s);\n\n      // console.log('bits', bits.toString(2));\n\n      this.drawPixel(pixels, x, y, palette[color*3], palette[color*3+1], palette[color*3+2]);\n\n      let bit = 0;\n\n      if (bit) {\n        if (bit) {\n          // color\n        } else { // read next palette index\n\n        }\n      }\n      else { // draw pixel\n        // this.drawPixel(pixels, x, y, palette[color*3], palette[color*3+1], palette[color*3+2]);\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  parseRoom(num) {\n    console.log('Parsing room', num, '...');\n    let stream = this.getBundleStream();\n    let offset = this.roomOffsets[num];\n\n    stream.seek(offset);\n\n    // Read and store the block offsets RMHD, CLUT etc\n\n    let block = this.readBlockHead(stream);\n    let end = offset + block.size;\n    let blocks = {};\n\n    while (stream.offset < end) {\n      let block = this.readBlockHead(stream);\n\n      let info = {\n        name: block.name,\n        size: block.size,\n        offset: stream.offset - 8\n      };\n\n      if (blocks[block.name]) {\n        if (blocks[block.name] instanceof Array) {\n          blocks[block.name].push(info);\n        } else {\n          blocks[block.name] = [ blocks[block.name], info ];\n        }\n      } else {\n        blocks[block.name] = info;\n      }\n\n      stream.getBytes(block.size - 8);\n\n      // console.log(block.name, block.size);\n    }\n\n    console.log(blocks);\n\n    this.roomBlockOffsets[num] = blocks;\n\n    // Read header data - width, height etc\n\n    stream.seek(blocks['RMHD'].offset + 8);\n    let width = stream.getUint16LE();\n    let height = stream.getUint16LE();\n    let numObjects = stream.getUint16LE();\n\n    console.log(this.roomNames[num], width, height, numObjects);\n\n    let room = new Room({ width: width, height: height, numObjects: numObjects });\n\n    // Read palette entries\n\n    if (blocks['CLUT']) {\n      stream.seek(blocks['CLUT'].offset + 8);\n\n      room.palette = [];\n      for (var i = 0; i < 256; i++) {\n        let r = stream.getUint8();\n        let g = stream.getUint8();\n        let b = stream.getUint8();\n        room.palette.push(r, g, b);\n      }\n      // console.log(room.palette.length);\n    }\n\n    // Decode background image\n\n    if (blocks['RMIM']) {\n      stream.seek(blocks['RMIM'].offset + 8);\n\n      let block = this.readBlockHead(stream);\n      let numzbuf = stream.getUint16LE();\n\n      if (block.name == 'RMIH') {\n        let block = this.readBlockHead(stream);\n\n        if (block.name == 'IM00') {\n          let SMAPoffs = stream.offset;\n          let block = this.readBlockHead(stream);\n          if (block.name == 'SMAP') {\n            let offsets = [];\n            for (var i = 0; i < room.width / 8; i++) {\n              let offs = stream.getUint32LE();\n              offsets.push(offs);\n            }\n            this.decompressStrip(stream, room.palette);\n          }\n        }\n      }\n    }\n\n    this.rooms[num] = room;\n  }\n\n  parseBundle(num) {\n    let stream = this.getBundleStream();\n    let block = this.readBlockHead(stream);\n\n    let offset = 8;\n\n    if (block.name == 'LECF') {\n      let block = this.readBlockHead(stream);\n\n      if (block.name == 'LOFF') {\n        let numrooms = stream.getUint8();\n        for (var i = 0; i < numrooms; i++) {\n          let room = stream.getUint8();\n          let offs = stream.getUint32LE();\n          this.roomOffsets[room] = offs;\n        }\n      }\n    }\n  }\n\n  createPaletteElement(num) {\n    let room = this.rooms[num];\n\n    if (room && room.palette) {\n      let paletteEl = document.createElement('div');\n      paletteEl.classList.add('palette');\n\n      for (var i = 0; i < 256; i++) {\n        let r = room.palette[i*3];\n        let g = room.palette[i*3 + 1];\n        let b = room.palette[i*3 + 2];\n        let swatch = document.createElement('div');\n        swatch.classList.add('swatch');\n        swatch.style.backgroundColor = 'rgb('+r+','+g+','+b+')';\n        swatch.title = i + ':' + 'rgb('+r+','+g+','+b+')';\n        paletteEl.appendChild(swatch);\n      }\n\n      document.body.appendChild(paletteEl);\n    }\n  }\n\n  parseFiles() {\n    if (this.files[INDEX_FILE]) {\n      this.parseIndex();\n    }\n    if (this.files[BUNDLE_FILE]) {\n      this.parseBundle();\n      this.parseRoom(2);\n      this.createPaletteElement(2);\n    }\n  }\n\n  onFileLoaded(filename) {\n    console.log('Loaded', filename, this.files[filename].byteLength);\n\n    if (filename == INDEX_FILE || filename == BUNDLE_FILE) {\n      this.files[filename] = this.decode(this.files[filename], 0x69);\n    }\n\n    this.filesToLoad--;\n\n    if (this.filesToLoad == 0) {\n      console.log('Load done.');\n      this.parseFiles();\n    }\n  }\n\n  loadFile(file) {\n    var reader = new FileReader();\n    var filename = file.name.toLowerCase();\n\t\treader.onload = (event) => {\n      // console.log(event.target);\n      this.files[filename] = event.target.result;\n      this.onFileLoaded(filename);\n\t\t};\n\t  reader.readAsArrayBuffer(file);\n  }\n\n  onDrop(event) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    var files = event.dataTransfer.files;\n    if (files.length) {\n      this.filesToLoad = files.length;\n      for (var i = 0; i < files.length; i++) {\n        this.loadFile(files[i]);\n      }\n    }\n  }\n\n  onDragEnter(event) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  onDragOver(event) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  handleEvent(event) {\n    if (event.type == 'drop') {\n      this.onDrop(event);\n    }\n    else if (event.type == 'dragover') {\n      this.onDragOver(event);\n    }\n    else if (event.type == 'dragenter') {\n      this.onDragEnter(event);\n    }\n  }\n\n  initEventListeners() {\n    window.addEventListener('drop', this, false);\n    window.addEventListener('dragenter', this, false);\n    window.addEventListener('dragover', this, false);\n  }\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  let app = new App();\n});\n","\nclass BitStream {\n  constructor(stream) {\n    this.stream = stream;\n    this.offset = 0;\n    this.bit = 1;\n    this.byte = this.stream.getUint8();\n    this.stream.backup();\n  }\n\n  next() {\n    this.byte = this.stream.getUint8();\n    this.offset++;\n    this.bit = 1;\n  }\n\n  read(length=0) {\n    // console.log(this.byte.toString(2));\n    let value = 0;\n    if (length) {\n      let s = '';\n      for (var i = 0; i < length; i++) {\n        s += this.read();\n        // value = value + (this.read() << (length-i));\n      }\n      // console.log(s);\n      // value = value & (Math.pow(2, length) - 1);\n    }\n    else {\n      value = (this.byte & this.bit ? 1 : 0);\n      if (this.bit == 128) {\n        this.next();\n      } else {\n        this.bit = this.bit * 2;\n      }\n    }\n    return value;\n  }\n}\n\nmodule.exports = BitStream;\n","\nclass Bitmap {\n  constructor(params) {\n    this.width = params.width;\n    this.height = params.height;\n    this.pixels = params.pixels;\n  }\n}\n\nmodule.exports = Bitmap;\n","\nclass BufferStream {\n  constructor(buffer) {\n    this.buffer = buffer;\n    this.view = new DataView(this.buffer);\n    this.offset = 0;\n  }\n\n  get length() {\n    return this.buffer.byteLength;\n  }\n\n  seek(offset=0) {\n    this.offset = offset;\n  }\n  \n  backup() {\n    if (this.offset > 0)\n      this.offset--;\n  }\n\n  getUint8(offset) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset++;\n    }\n    return this.view.getUint8(offset);\n  }\n\n  getUint16(offset, littleEndian=false) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += 2;\n    }\n    return this.view.getUint16(offset, littleEndian);\n  }\n\n  getUint32(offset, littleEndian=false) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += 4;\n    }\n    return this.view.getUint32(offset, littleEndian);\n  }\n\n  getUint16LE(offset) {\n    return this.getUint16(offset, true);\n  }\n\n  getUint32LE(offset) {\n    return this.getUint32(offset, true);\n  }\n\n  getBytes(length=1, offset) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += length;\n    }\n    let bytes = new Uint8Array(length);\n    for (var i = 0; i < length; i++) {\n      bytes[i] = this.view.getUint8(offset + i); //this.getUint8(offset + i);\n    }\n    return bytes;\n  }\n}\n\nmodule.exports = BufferStream;\n","const Bitmap = require('./bitmap');\n\nclass Room {\n  constructor(params) {\n    this.width = params.width;\n    this.height = params.height;\n    this.numObjects = params.numObjects;\n  }\n}\n\nmodule.exports = Room;\n","\nclass Scumm {\n  constructor() {\n    \n  }\n}\n\nmodule.exports = Scumm;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwic3JjL2JpdF9zdHJlYW0uanMiLCJzcmMvYml0bWFwLmpzIiwic3JjL2J1ZmZlcl9zdHJlYW0uanMiLCJzcmMvcm9vbS5qcyIsInNyYy9zY3VtbS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLE1BQU0sUUFBUSxRQUFRLFNBQVIsQ0FBZDtBQUNBLE1BQU0sU0FBUyxRQUFRLFVBQVIsQ0FBZjtBQUNBLE1BQU0sT0FBTyxRQUFRLFFBQVIsQ0FBYjtBQUNBLE1BQU0sZUFBZSxRQUFRLGlCQUFSLENBQXJCO0FBQ0EsTUFBTSxZQUFZLFFBQVEsY0FBUixDQUFsQjs7QUFFQSxNQUFNLGFBQWEsYUFBbkI7QUFDQSxNQUFNLGNBQWMsYUFBcEI7QUFDQTtBQUNBOztBQUVBLE1BQU0sR0FBTixDQUFVO0FBQ1IsZ0JBQWM7QUFDWixZQUFRLEdBQVIsQ0FBWSxLQUFaOztBQUVBLFNBQUssS0FBTCxHQUFhLEVBQWI7QUFDQSxTQUFLLFNBQUwsR0FBaUIsRUFBakI7QUFDQSxTQUFLLFdBQUwsR0FBbUIsRUFBbkI7QUFDQSxTQUFLLGdCQUFMLEdBQXdCLEVBQXhCO0FBQ0EsU0FBSyxLQUFMLEdBQWEsRUFBYjs7QUFFQSxRQUFJLFNBQVMsU0FBUyxhQUFULENBQXVCLFFBQXZCLENBQWI7QUFDQSxXQUFPLEtBQVAsR0FBZSxHQUFmO0FBQ0EsV0FBTyxNQUFQLEdBQWdCLEdBQWhCO0FBQ0EsV0FBTyxLQUFQLENBQWEsZUFBYixHQUErQixXQUEvQjtBQUNBO0FBQ0E7QUFDQSxhQUFTLElBQVQsQ0FBYyxXQUFkLENBQTBCLE1BQTFCOztBQUVBLFNBQUssTUFBTCxHQUFjLE1BQWQ7O0FBRUEsU0FBSyxrQkFBTDtBQUNEOztBQUVELFNBQU8sTUFBUCxFQUFlLE1BQUksQ0FBbkIsRUFBc0I7QUFDcEIsUUFBSSxPQUFPLElBQUksVUFBSixDQUFlLE1BQWYsQ0FBWDtBQUNB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QixRQUFJLFVBQVUsU0FBZCxFQUF5QjtBQUN2QixlQUFTLEtBQUssTUFBZDtBQUNBLFdBQUssTUFBTCxJQUFlLE1BQWY7QUFDRDtBQUNELFFBQUksUUFBUSxJQUFJLFVBQUosQ0FBZSxNQUFmLENBQVo7QUFDQSxTQUFLLElBQUksSUFBSSxDQUFiLEVBQWdCLElBQUksTUFBcEIsRUFBNEIsR0FBNUIsRUFBaUM7QUFDL0IsWUFBTSxDQUFOLElBQVcsS0FBSyxJQUFMLENBQVUsUUFBVixDQUFtQixTQUFTLENBQTVCLENBQVgsQ0FEK0IsQ0FDWTtBQUM1QztBQUNELFdBQU8sS0FBUDtBQUNEO0FBOURnQjs7QUFpRW5CLE9BQU8sT0FBUCxHQUFpQixZQUFqQjs7O0FDbEVBLE1BQU0sU0FBUyxRQUFRLFVBQVIsQ0FBZjs7QUFFQSxNQUFNLElBQU4sQ0FBVztBQUNULGNBQVksTUFBWixFQUFvQjtBQUNsQixTQUFLLEtBQUwsR0FBYSxPQUFPLEtBQXBCO0FBQ0EsU0FBSyxNQUFMLEdBQWMsT0FBTyxNQUFyQjtBQUNBLFNBQUssVUFBTCxHQUFrQixPQUFPLFVBQXpCO0FBQ0Q7QUFMUTs7QUFRWCxPQUFPLE9BQVAsR0FBaUIsSUFBakI7Ozs7QUNUQSxNQUFNLEtBQU4sQ0FBWTtBQUNWLGdCQUFjLENBRWI7QUFIUzs7QUFNWixPQUFPLE9BQVAsR0FBaUIsS0FBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfXJldHVybiBlfSkoKSIsImNvbnN0IFNjdW1tID0gcmVxdWlyZSgnLi9zY3VtbScpO1xuY29uc3QgQml0bWFwID0gcmVxdWlyZSgnLi9iaXRtYXAnKTtcbmNvbnN0IFJvb20gPSByZXF1aXJlKCcuL3Jvb20nKTtcbmNvbnN0IEJ1ZmZlclN0cmVhbSA9IHJlcXVpcmUoJy4vYnVmZmVyX3N0cmVhbScpO1xuY29uc3QgQml0U3RyZWFtID0gcmVxdWlyZSgnLi9iaXRfc3RyZWFtJyk7XG5cbmNvbnN0IElOREVYX0ZJTEUgPSAnbW9ua2V5Mi4wMDAnO1xuY29uc3QgQlVORExFX0ZJTEUgPSAnbW9ua2V5Mi4wMDEnO1xuLy8gY29uc3QgSU5ERVhfRklMRSA9ICdtaTJkZW1vLjAwMCc7XG4vLyBjb25zdCBCVU5ETEVfRklMRSA9ICdtaTJkZW1vLjAwMSc7XG5cbmNsYXNzIEFwcCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnNvbGUubG9nKCdBcHAnKTtcblxuICAgIHRoaXMuZmlsZXMgPSBbXTtcbiAgICB0aGlzLnJvb21OYW1lcyA9IFtdO1xuICAgIHRoaXMucm9vbU9mZnNldHMgPSBbXTtcbiAgICB0aGlzLnJvb21CbG9ja09mZnNldHMgPSBbXTtcbiAgICB0aGlzLnJvb21zID0gW107XG5cbiAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY2FudmFzLndpZHRoID0gMzIwO1xuICAgIGNhbnZhcy5oZWlnaHQgPSAyMDA7XG4gICAgY2FudmFzLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdsaWdodGdyYXknO1xuICAgIC8vIGNhbnZhcy5zdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAnMCAwJztcbiAgICAvLyBjYW52YXMuc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDQpJztcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGNhbnZhcyk7XG5cbiAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcblxuICAgIHRoaXMuaW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBkZWNvZGUoYnVmZmVyLCBlbmM9MCkge1xuICAgIGxldCB0ZW1wID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRlbXAubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRlbXBbaV0gPSB0ZW1wW2ldIF4gZW5jO1xuICAgIH1cbiAgICByZXR1cm4gdGVtcC5idWZmZXI7XG4gIH1cblxuICBnZXRCbG9ja1R5cGVOYW1lKHVpbnQzMikge1xuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKFxuICAgICAgKHVpbnQzMiAmIDB4ZmYpLFxuICAgICAgKCh1aW50MzIgPj4gOCkgJiAweGZmKSxcbiAgICAgICgodWludDMyID4+IDE2KSAmIDB4ZmYpLFxuICAgICAgKCh1aW50MzIgPj4gMjQpICYgMHhmZilcbiAgICApO1xuICB9XG5cbiAgcGFyc2VJbmRleCgpIHtcbiAgICBpZiAoIXRoaXMuZmlsZXNbSU5ERVhfRklMRV0pIHJldHVybjtcbiAgICBsZXQgc3RyZWFtID0gbmV3IEJ1ZmZlclN0cmVhbSh0aGlzLmZpbGVzW0lOREVYX0ZJTEVdKTtcblxuICAgIHdoaWxlIChzdHJlYW0ub2Zmc2V0IDwgc3RyZWFtLmxlbmd0aCkge1xuICAgICAgbGV0IHR5cGUgPSBzdHJlYW0uZ2V0VWludDMyTEUoKTtcbiAgICAgIGxldCBzaXplID0gc3RyZWFtLmdldFVpbnQzMigpO1xuICAgICAgbGV0IG5hbWUgPSB0aGlzLmdldEJsb2NrVHlwZU5hbWUodHlwZSk7XG5cbiAgICAgIGlmIChuYW1lID09ICdSTkFNJykgeyAvLyBSb29tIG5hbWVzIHRhYmxlXG4gICAgICAgIHdoaWxlICgxKSB7XG4gICAgICAgICAgbGV0IHJvb21ubyA9IHN0cmVhbS5nZXRVaW50OCgpO1xuICAgICAgICAgIGlmIChyb29tbm8gPT0gMCkgYnJlYWs7XG5cbiAgICAgICAgICBsZXQgYnl0ZXMgPSBzdHJlYW0uZ2V0Qnl0ZXMoOSk7XG4gICAgICAgICAgdGhpcy5yb29tTmFtZXNbcm9vbW5vXSA9IGJ5dGVzLnJlZHVjZSgoYWNjdW11bGF0b3IsIGN1cnJlbnRWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yICsgKGN1cnJlbnRWYWx1ZSAhPSAweGZmID8gU3RyaW5nLmZyb21DaGFyQ29kZShjdXJyZW50VmFsdWUgXiAweGZmKSA6ICcnKTtcbiAgICAgICAgICB9LCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2codGhpcy5yb29tTmFtZXMpO1xuICAgICAgLy8gfVxuICAgICAgLy8gZWxzZSBpZiAobmFtZSA9PSAnRFJPTycpIHtcbiAgICAgIC8vICAgbGV0IG51bWl0ZW1zID0gc3RyZWFtLmdldFVpbnQxNkxFKCk7XG4gICAgICAvLyAgIGxldCByb29tTm9zID0gc3RyZWFtLmdldEJ5dGVzKCwgbnVtaXRlbXMpO1xuICAgICAgLy9cbiAgICAgIC8vICAgbGV0IHJvb21PZmZzZXRzID0gW107XG4gICAgICAvLyAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtaXRlbXM7IGkrKykge1xuICAgICAgLy8gICAgIGxldCBvZmZzID0gc3RyZWFtLmdldFVpbnQzMkxFKCk7XG4gICAgICAvLyAgICAgcm9vbU9mZnNldHNbaV0gPSBvZmZzO1xuICAgICAgLy8gICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHJlYW0uZ2V0Qnl0ZXMoc2l6ZSAtIDgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldEJ1bmRsZVN0cmVhbSgpIHtcbiAgICBsZXQgZmlsZW5hbWUgPSBCVU5ETEVfRklMRTtcbiAgICBpZiAoIXRoaXMuZmlsZXNbZmlsZW5hbWVdKSByZXR1cm47XG4gICAgbGV0IHN0cmVhbSA9IG5ldyBCdWZmZXJTdHJlYW0odGhpcy5maWxlc1tmaWxlbmFtZV0pO1xuICAgIHJldHVybiBzdHJlYW07XG4gIH1cblxuICByZWFkQmxvY2tIZWFkKHN0cmVhbSkge1xuICAgIGxldCB0eXBlID0gc3RyZWFtLmdldFVpbnQzMkxFKCk7XG4gICAgbGV0IHNpemUgPSBzdHJlYW0uZ2V0VWludDMyKCk7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmdldEJsb2NrVHlwZU5hbWUodHlwZSk7XG4gICAgcmV0dXJuIHsgbmFtZTogbmFtZSwgdHlwZTogdHlwZSwgc2l6ZTogc2l6ZSB9O1xuICB9XG5cbiAgZHJhd1BpeGVsKHBpeGVscywgeCwgeSwgciwgZywgYikge1xuICAgIGxldCBpbmRleCA9ICh5ICogMzIwICsgeCkgKiA0O1xuICAgIHBpeGVsc1tpbmRleCswXSA9IHI7XG4gICAgcGl4ZWxzW2luZGV4KzFdID0gZztcbiAgICBwaXhlbHNbaW5kZXgrMl0gPSBiO1xuICAgIHBpeGVsc1tpbmRleCszXSA9IDI1NTtcbiAgICAvLyBjb25zb2xlLmxvZygncGl4ZWwnLCB4LCB5LCByLCBnLCBiKTtcbiAgfVxuXG4gIGRlY29tcHJlc3NTdHJpcChzdHJlYW0sIHBhbGV0dGUpIHtcbiAgICBjb25zb2xlLmxvZygnZGVjb2RpbmcuLi4nKTtcblxuICAgIGxldCBjdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGxldCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLmNhbnZhcy5oZWlnaHQpO1xuICAgIGxldCBwaXhlbHMgPSBpbWFnZURhdGEuZGF0YTtcbiAgICBsZXQgeCA9IDAsIHkgPSAwO1xuXG4gICAgbGV0IGNvZGUgPSBzdHJlYW0uZ2V0VWludDgoKTtcbiAgICBsZXQgc2hpZnQgPSBjb2RlICUgMTA7XG4gICAgbGV0IG1hc2sgPSAweGZmID4+ICg4IC0gc2hpZnQpO1xuXG4gICAgbGV0IGJpdHN0cmVhbSA9IG5ldyBCaXRTdHJlYW0oc3RyZWFtKTtcblxuICAgIGlmIChjb2RlID49IDB4NDAgJiYgY29kZSA8PSAweDQ0KSB7XG4gICAgICBjb25zb2xlLmxvZygnTWV0aG9kIEIgSG9yaXpvbnRhbCcsIGNvZGUsIHNoaWZ0KTtcblxuICAgICAgbGV0IGNvbG9yID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICBjb25zb2xlLmxvZyhjb2xvci50b1N0cmluZygyKSk7XG4gICAgICBjb25zb2xlLmxvZygnY29sb3InLCBjb2xvciwgcGFsZXR0ZVtjb2xvciozXSwgcGFsZXR0ZVtjb2xvciozKzFdLCBwYWxldHRlW2NvbG9yKjMrMl0pO1xuICAgICAgc3RyZWFtLmJhY2t1cCgpO1xuICAgICAgLy8gYml0c3RyZWFtLnJlYWQoOCk7XG4gICAgICBsZXQgcyA9ICcnO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA4OyBpKyspIHtcbiAgICAgICAgcyArPSBiaXRzdHJlYW0ucmVhZCgpO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2cocyk7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKCdiaXRzJywgYml0cy50b1N0cmluZygyKSk7XG5cbiAgICAgIHRoaXMuZHJhd1BpeGVsKHBpeGVscywgeCwgeSwgcGFsZXR0ZVtjb2xvciozXSwgcGFsZXR0ZVtjb2xvciozKzFdLCBwYWxldHRlW2NvbG9yKjMrMl0pO1xuXG4gICAgICBsZXQgYml0ID0gMDtcblxuICAgICAgaWYgKGJpdCkge1xuICAgICAgICBpZiAoYml0KSB7XG4gICAgICAgICAgLy8gY29sb3JcbiAgICAgICAgfSBlbHNlIHsgLy8gcmVhZCBuZXh0IHBhbGV0dGUgaW5kZXhcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHsgLy8gZHJhdyBwaXhlbFxuICAgICAgICAvLyB0aGlzLmRyYXdQaXhlbChwaXhlbHMsIHgsIHksIHBhbGV0dGVbY29sb3IqM10sIHBhbGV0dGVbY29sb3IqMysxXSwgcGFsZXR0ZVtjb2xvciozKzJdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gIH1cblxuICBwYXJzZVJvb20obnVtKSB7XG4gICAgY29uc29sZS5sb2coJ1BhcnNpbmcgcm9vbScsIG51bSwgJy4uLicpO1xuICAgIGxldCBzdHJlYW0gPSB0aGlzLmdldEJ1bmRsZVN0cmVhbSgpO1xuICAgIGxldCBvZmZzZXQgPSB0aGlzLnJvb21PZmZzZXRzW251bV07XG5cbiAgICBzdHJlYW0uc2VlayhvZmZzZXQpO1xuXG4gICAgLy8gUmVhZCBhbmQgc3RvcmUgdGhlIGJsb2NrIG9mZnNldHMgUk1IRCwgQ0xVVCBldGNcblxuICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuICAgIGxldCBlbmQgPSBvZmZzZXQgKyBibG9jay5zaXplO1xuICAgIGxldCBibG9ja3MgPSB7fTtcblxuICAgIHdoaWxlIChzdHJlYW0ub2Zmc2V0IDwgZW5kKSB7XG4gICAgICBsZXQgYmxvY2sgPSB0aGlzLnJlYWRCbG9ja0hlYWQoc3RyZWFtKTtcblxuICAgICAgbGV0IGluZm8gPSB7XG4gICAgICAgIG5hbWU6IGJsb2NrLm5hbWUsXG4gICAgICAgIHNpemU6IGJsb2NrLnNpemUsXG4gICAgICAgIG9mZnNldDogc3RyZWFtLm9mZnNldCAtIDhcbiAgICAgIH07XG5cbiAgICAgIGlmIChibG9ja3NbYmxvY2submFtZV0pIHtcbiAgICAgICAgaWYgKGJsb2Nrc1tibG9jay5uYW1lXSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgYmxvY2tzW2Jsb2NrLm5hbWVdLnB1c2goaW5mbyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYmxvY2tzW2Jsb2NrLm5hbWVdID0gWyBibG9ja3NbYmxvY2submFtZV0sIGluZm8gXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYmxvY2tzW2Jsb2NrLm5hbWVdID0gaW5mbztcbiAgICAgIH1cblxuICAgICAgc3RyZWFtLmdldEJ5dGVzKGJsb2NrLnNpemUgLSA4KTtcblxuICAgICAgLy8gY29uc29sZS5sb2coYmxvY2submFtZSwgYmxvY2suc2l6ZSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYmxvY2tzKTtcblxuICAgIHRoaXMucm9vbUJsb2NrT2Zmc2V0c1tudW1dID0gYmxvY2tzO1xuXG4gICAgLy8gUmVhZCBoZWFkZXIgZGF0YSAtIHdpZHRoLCBoZWlnaHQgZXRjXG5cbiAgICBzdHJlYW0uc2VlayhibG9ja3NbJ1JNSEQnXS5vZmZzZXQgKyA4KTtcbiAgICBsZXQgd2lkdGggPSBzdHJlYW0uZ2V0VWludDE2TEUoKTtcbiAgICBsZXQgaGVpZ2h0ID0gc3RyZWFtLmdldFVpbnQxNkxFKCk7XG4gICAgbGV0IG51bU9iamVjdHMgPSBzdHJlYW0uZ2V0VWludDE2TEUoKTtcblxuICAgIGNvbnNvbGUubG9nKHRoaXMucm9vbU5hbWVzW251bV0sIHdpZHRoLCBoZWlnaHQsIG51bU9iamVjdHMpO1xuXG4gICAgbGV0IHJvb20gPSBuZXcgUm9vbSh7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIG51bU9iamVjdHM6IG51bU9iamVjdHMgfSk7XG5cbiAgICAvLyBSZWFkIHBhbGV0dGUgZW50cmllc1xuXG4gICAgaWYgKGJsb2Nrc1snQ0xVVCddKSB7XG4gICAgICBzdHJlYW0uc2VlayhibG9ja3NbJ0NMVVQnXS5vZmZzZXQgKyA4KTtcblxuICAgICAgcm9vbS5wYWxldHRlID0gW107XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgIGxldCByID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgIGxldCBnID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgIGxldCBiID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgIHJvb20ucGFsZXR0ZS5wdXNoKHIsIGcsIGIpO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2cocm9vbS5wYWxldHRlLmxlbmd0aCk7XG4gICAgfVxuXG4gICAgLy8gRGVjb2RlIGJhY2tncm91bmQgaW1hZ2VcblxuICAgIGlmIChibG9ja3NbJ1JNSU0nXSkge1xuICAgICAgc3RyZWFtLnNlZWsoYmxvY2tzWydSTUlNJ10ub2Zmc2V0ICsgOCk7XG5cbiAgICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuICAgICAgbGV0IG51bXpidWYgPSBzdHJlYW0uZ2V0VWludDE2TEUoKTtcblxuICAgICAgaWYgKGJsb2NrLm5hbWUgPT0gJ1JNSUgnKSB7XG4gICAgICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuXG4gICAgICAgIGlmIChibG9jay5uYW1lID09ICdJTTAwJykge1xuICAgICAgICAgIGxldCBTTUFQb2ZmcyA9IHN0cmVhbS5vZmZzZXQ7XG4gICAgICAgICAgbGV0IGJsb2NrID0gdGhpcy5yZWFkQmxvY2tIZWFkKHN0cmVhbSk7XG4gICAgICAgICAgaWYgKGJsb2NrLm5hbWUgPT0gJ1NNQVAnKSB7XG4gICAgICAgICAgICBsZXQgb2Zmc2V0cyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb29tLndpZHRoIC8gODsgaSsrKSB7XG4gICAgICAgICAgICAgIGxldCBvZmZzID0gc3RyZWFtLmdldFVpbnQzMkxFKCk7XG4gICAgICAgICAgICAgIG9mZnNldHMucHVzaChvZmZzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZGVjb21wcmVzc1N0cmlwKHN0cmVhbSwgcm9vbS5wYWxldHRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnJvb21zW251bV0gPSByb29tO1xuICB9XG5cbiAgcGFyc2VCdW5kbGUobnVtKSB7XG4gICAgbGV0IHN0cmVhbSA9IHRoaXMuZ2V0QnVuZGxlU3RyZWFtKCk7XG4gICAgbGV0IGJsb2NrID0gdGhpcy5yZWFkQmxvY2tIZWFkKHN0cmVhbSk7XG5cbiAgICBsZXQgb2Zmc2V0ID0gODtcblxuICAgIGlmIChibG9jay5uYW1lID09ICdMRUNGJykge1xuICAgICAgbGV0IGJsb2NrID0gdGhpcy5yZWFkQmxvY2tIZWFkKHN0cmVhbSk7XG5cbiAgICAgIGlmIChibG9jay5uYW1lID09ICdMT0ZGJykge1xuICAgICAgICBsZXQgbnVtcm9vbXMgPSBzdHJlYW0uZ2V0VWludDgoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1yb29tczsgaSsrKSB7XG4gICAgICAgICAgbGV0IHJvb20gPSBzdHJlYW0uZ2V0VWludDgoKTtcbiAgICAgICAgICBsZXQgb2ZmcyA9IHN0cmVhbS5nZXRVaW50MzJMRSgpO1xuICAgICAgICAgIHRoaXMucm9vbU9mZnNldHNbcm9vbV0gPSBvZmZzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY3JlYXRlUGFsZXR0ZUVsZW1lbnQobnVtKSB7XG4gICAgbGV0IHJvb20gPSB0aGlzLnJvb21zW251bV07XG5cbiAgICBpZiAocm9vbSAmJiByb29tLnBhbGV0dGUpIHtcbiAgICAgIGxldCBwYWxldHRlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHBhbGV0dGVFbC5jbGFzc0xpc3QuYWRkKCdwYWxldHRlJyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHtcbiAgICAgICAgbGV0IHIgPSByb29tLnBhbGV0dGVbaSozXTtcbiAgICAgICAgbGV0IGcgPSByb29tLnBhbGV0dGVbaSozICsgMV07XG4gICAgICAgIGxldCBiID0gcm9vbS5wYWxldHRlW2kqMyArIDJdO1xuICAgICAgICBsZXQgc3dhdGNoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHN3YXRjaC5jbGFzc0xpc3QuYWRkKCdzd2F0Y2gnKTtcbiAgICAgICAgc3dhdGNoLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICdyZ2IoJytyKycsJytnKycsJytiKycpJztcbiAgICAgICAgc3dhdGNoLnRpdGxlID0gaSArICc6JyArICdyZ2IoJytyKycsJytnKycsJytiKycpJztcbiAgICAgICAgcGFsZXR0ZUVsLmFwcGVuZENoaWxkKHN3YXRjaCk7XG4gICAgICB9XG5cbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGFsZXR0ZUVsKTtcbiAgICB9XG4gIH1cblxuICBwYXJzZUZpbGVzKCkge1xuICAgIGlmICh0aGlzLmZpbGVzW0lOREVYX0ZJTEVdKSB7XG4gICAgICB0aGlzLnBhcnNlSW5kZXgoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuZmlsZXNbQlVORExFX0ZJTEVdKSB7XG4gICAgICB0aGlzLnBhcnNlQnVuZGxlKCk7XG4gICAgICB0aGlzLnBhcnNlUm9vbSgyKTtcbiAgICAgIHRoaXMuY3JlYXRlUGFsZXR0ZUVsZW1lbnQoMik7XG4gICAgfVxuICB9XG5cbiAgb25GaWxlTG9hZGVkKGZpbGVuYW1lKSB7XG4gICAgY29uc29sZS5sb2coJ0xvYWRlZCcsIGZpbGVuYW1lLCB0aGlzLmZpbGVzW2ZpbGVuYW1lXS5ieXRlTGVuZ3RoKTtcblxuICAgIGlmIChmaWxlbmFtZSA9PSBJTkRFWF9GSUxFIHx8IGZpbGVuYW1lID09IEJVTkRMRV9GSUxFKSB7XG4gICAgICB0aGlzLmZpbGVzW2ZpbGVuYW1lXSA9IHRoaXMuZGVjb2RlKHRoaXMuZmlsZXNbZmlsZW5hbWVdLCAweDY5KTtcbiAgICB9XG5cbiAgICB0aGlzLmZpbGVzVG9Mb2FkLS07XG5cbiAgICBpZiAodGhpcy5maWxlc1RvTG9hZCA9PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZygnTG9hZCBkb25lLicpO1xuICAgICAgdGhpcy5wYXJzZUZpbGVzKCk7XG4gICAgfVxuICB9XG5cbiAgbG9hZEZpbGUoZmlsZSkge1xuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIHZhciBmaWxlbmFtZSA9IGZpbGUubmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpID0+IHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LnRhcmdldCk7XG4gICAgICB0aGlzLmZpbGVzW2ZpbGVuYW1lXSA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICB0aGlzLm9uRmlsZUxvYWRlZChmaWxlbmFtZSk7XG5cdFx0fTtcblx0ICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZmlsZSk7XG4gIH1cblxuICBvbkRyb3AoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgdmFyIGZpbGVzID0gZXZlbnQuZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgIGlmIChmaWxlcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuZmlsZXNUb0xvYWQgPSBmaWxlcy5sZW5ndGg7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMubG9hZEZpbGUoZmlsZXNbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uRHJhZ0VudGVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIG9uRHJhZ092ZXIoZXZlbnQpIHtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG5cbiAgaGFuZGxlRXZlbnQoZXZlbnQpIHtcbiAgICBpZiAoZXZlbnQudHlwZSA9PSAnZHJvcCcpIHtcbiAgICAgIHRoaXMub25Ecm9wKGV2ZW50KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PSAnZHJhZ292ZXInKSB7XG4gICAgICB0aGlzLm9uRHJhZ092ZXIoZXZlbnQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChldmVudC50eXBlID09ICdkcmFnZW50ZXInKSB7XG4gICAgICB0aGlzLm9uRHJhZ0VudGVyKGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICBpbml0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCB0aGlzLCBmYWxzZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbnRlcicsIHRoaXMsIGZhbHNlKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ292ZXInLCB0aGlzLCBmYWxzZSk7XG4gIH1cbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gIGxldCBhcHAgPSBuZXcgQXBwKCk7XG59KTtcbiIsIlxuY2xhc3MgQml0U3RyZWFtIHtcbiAgY29uc3RydWN0b3Ioc3RyZWFtKSB7XG4gICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07XG4gICAgdGhpcy5vZmZzZXQgPSAwO1xuICAgIHRoaXMuYml0ID0gMTtcbiAgICB0aGlzLmJ5dGUgPSB0aGlzLnN0cmVhbS5nZXRVaW50OCgpO1xuICAgIHRoaXMuc3RyZWFtLmJhY2t1cCgpO1xuICB9XG5cbiAgbmV4dCgpIHtcbiAgICB0aGlzLmJ5dGUgPSB0aGlzLnN0cmVhbS5nZXRVaW50OCgpO1xuICAgIHRoaXMub2Zmc2V0Kys7XG4gICAgdGhpcy5iaXQgPSAxO1xuICB9XG5cbiAgcmVhZChsZW5ndGg9MCkge1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuYnl0ZS50b1N0cmluZygyKSk7XG4gICAgbGV0IHZhbHVlID0gMDtcbiAgICBpZiAobGVuZ3RoKSB7XG4gICAgICBsZXQgcyA9ICcnO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBzICs9IHRoaXMucmVhZCgpO1xuICAgICAgICAvLyB2YWx1ZSA9IHZhbHVlICsgKHRoaXMucmVhZCgpIDw8IChsZW5ndGgtaSkpO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2cocyk7XG4gICAgICAvLyB2YWx1ZSA9IHZhbHVlICYgKE1hdGgucG93KDIsIGxlbmd0aCkgLSAxKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB2YWx1ZSA9ICh0aGlzLmJ5dGUgJiB0aGlzLmJpdCA/IDEgOiAwKTtcbiAgICAgIGlmICh0aGlzLmJpdCA9PSAxMjgpIHtcbiAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmJpdCA9IHRoaXMuYml0ICogMjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQml0U3RyZWFtO1xuIiwiXG5jbGFzcyBCaXRtYXAge1xuICBjb25zdHJ1Y3RvcihwYXJhbXMpIHtcbiAgICB0aGlzLndpZHRoID0gcGFyYW1zLndpZHRoO1xuICAgIHRoaXMuaGVpZ2h0ID0gcGFyYW1zLmhlaWdodDtcbiAgICB0aGlzLnBpeGVscyA9IHBhcmFtcy5waXhlbHM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBCaXRtYXA7XG4iLCJcbmNsYXNzIEJ1ZmZlclN0cmVhbSB7XG4gIGNvbnN0cnVjdG9yKGJ1ZmZlcikge1xuICAgIHRoaXMuYnVmZmVyID0gYnVmZmVyO1xuICAgIHRoaXMudmlldyA9IG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlcik7XG4gICAgdGhpcy5vZmZzZXQgPSAwO1xuICB9XG5cbiAgZ2V0IGxlbmd0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5idWZmZXIuYnl0ZUxlbmd0aDtcbiAgfVxuXG4gIHNlZWsob2Zmc2V0PTApIHtcbiAgICB0aGlzLm9mZnNldCA9IG9mZnNldDtcbiAgfVxuICBcbiAgYmFja3VwKCkge1xuICAgIGlmICh0aGlzLm9mZnNldCA+IDApXG4gICAgICB0aGlzLm9mZnNldC0tO1xuICB9XG5cbiAgZ2V0VWludDgob2Zmc2V0KSB7XG4gICAgaWYgKG9mZnNldCA9PSB1bmRlZmluZWQpIHtcbiAgICAgIG9mZnNldCA9IHRoaXMub2Zmc2V0O1xuICAgICAgdGhpcy5vZmZzZXQrKztcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudmlldy5nZXRVaW50OChvZmZzZXQpO1xuICB9XG5cbiAgZ2V0VWludDE2KG9mZnNldCwgbGl0dGxlRW5kaWFuPWZhbHNlKSB7XG4gICAgaWYgKG9mZnNldCA9PSB1bmRlZmluZWQpIHtcbiAgICAgIG9mZnNldCA9IHRoaXMub2Zmc2V0O1xuICAgICAgdGhpcy5vZmZzZXQgKz0gMjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudmlldy5nZXRVaW50MTYob2Zmc2V0LCBsaXR0bGVFbmRpYW4pO1xuICB9XG5cbiAgZ2V0VWludDMyKG9mZnNldCwgbGl0dGxlRW5kaWFuPWZhbHNlKSB7XG4gICAgaWYgKG9mZnNldCA9PSB1bmRlZmluZWQpIHtcbiAgICAgIG9mZnNldCA9IHRoaXMub2Zmc2V0O1xuICAgICAgdGhpcy5vZmZzZXQgKz0gNDtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMudmlldy5nZXRVaW50MzIob2Zmc2V0LCBsaXR0bGVFbmRpYW4pO1xuICB9XG5cbiAgZ2V0VWludDE2TEUob2Zmc2V0KSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0VWludDE2KG9mZnNldCwgdHJ1ZSk7XG4gIH1cblxuICBnZXRVaW50MzJMRShvZmZzZXQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRVaW50MzIob2Zmc2V0LCB0cnVlKTtcbiAgfVxuXG4gIGdldEJ5dGVzKGxlbmd0aD0xLCBvZmZzZXQpIHtcbiAgICBpZiAob2Zmc2V0ID09IHVuZGVmaW5lZCkge1xuICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQ7XG4gICAgICB0aGlzLm9mZnNldCArPSBsZW5ndGg7XG4gICAgfVxuICAgIGxldCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgYnl0ZXNbaV0gPSB0aGlzLnZpZXcuZ2V0VWludDgob2Zmc2V0ICsgaSk7IC8vdGhpcy5nZXRVaW50OChvZmZzZXQgKyBpKTtcbiAgICB9XG4gICAgcmV0dXJuIGJ5dGVzO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQnVmZmVyU3RyZWFtO1xuIiwiY29uc3QgQml0bWFwID0gcmVxdWlyZSgnLi9iaXRtYXAnKTtcblxuY2xhc3MgUm9vbSB7XG4gIGNvbnN0cnVjdG9yKHBhcmFtcykge1xuICAgIHRoaXMud2lkdGggPSBwYXJhbXMud2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSBwYXJhbXMuaGVpZ2h0O1xuICAgIHRoaXMubnVtT2JqZWN0cyA9IHBhcmFtcy5udW1PYmplY3RzO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gUm9vbTtcbiIsIlxuY2xhc3MgU2N1bW0ge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFNjdW1tO1xuIl19"}