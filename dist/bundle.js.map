{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/app.js","src/bitmap.js","src/buffer_stream.js","src/room.js","src/scumm.js"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","const Scumm = require('./scumm');\nconst Bitmap = require('./bitmap');\nconst Room = require('./room');\nconst BufferStream = require('./buffer_stream');\n\nclass App {\n  constructor() {\n    console.log('App');\n    this.files = [];\n    this.roomNames = [];\n    this.roomOffsets = [];\n    this.roomBlockOffsets = [];\n    this.rooms = [];\n  }\n\n  decode(buffer, enc=0) {\n    let temp = new Uint8Array(buffer);\n    for (var i = 0; i < temp.length; i++) {\n      temp[i] = temp[i] ^ enc;\n    }\n    return temp.buffer;\n  }\n\n  getBlockTypeName(uint32) {\n    return String.fromCharCode(\n      (uint32 & 0xff),\n      ((uint32 >> 8) & 0xff),\n      ((uint32 >> 16) & 0xff),\n      ((uint32 >> 24) & 0xff)\n    );\n  }\n\n  parseIndexBlock(stream, offset) {\n    let type = stream.getUint32LE();\n    let size = stream.getUint32();\n\n    let name = this.getBlockTypeName(type);\n    console.log(name, size);\n\n    if (name == 'RNAM') {\n      while (1) {\n        let roomno = stream.getUint8();\n        if (roomno == 0) break;\n\n        let bytes = stream.getBytes(9);\n        this.roomNames[roomno] = bytes.reduce((accumulator, currentValue) => {\n          return accumulator + (currentValue != 0xff ? String.fromCharCode(currentValue ^ 0xff) : '');\n        }, '');\n        // offset += 10;\n      }\n      console.log(this.roomNames);\n    }\n    // else if (name == 'DROO') {\n    //   let numitems = stream.getUint16LE();\n    //   let roomNos = stream.getBytes(, numitems);\n    //\n    //   let roomOffsets = [];\n    //   for (var i = 0; i < numitems; i++) {\n    //     let offs = stream.getUint32LE();\n    //     roomOffsets[i] = offs;\n    //   }\n    // }\n    else {\n      stream.getBytes(size - 8);\n    }\n\n  }\n\n  parseIndex() {\n    if (!this.files['monkey2.000']) return;\n\n    let stream = new BufferStream(this.files['monkey2.000']);\n\n    let offset = 0;\n\n    while (offset < stream.length) {\n      let blocksize = stream.getUint32(offset + 4);\n      this.parseIndexBlock(stream, offset);\n      offset += blocksize;\n    }\n  }\n\n  getBundleStream() {\n    let filename = 'monkey2.001';\n    if (!this.files[filename]) return;\n    let stream = new BufferStream(this.files[filename]);\n    return stream;\n  }\n\n  readBlockHead(stream) {\n    let type = stream.getUint32LE();\n    let size = stream.getUint32();\n    let name = this.getBlockTypeName(type);\n    return { name: name, type: type, size: size };\n  }\n\n  parseRoomImage(num) {\n    let room = this.rooms[num];\n    if (!room) return;\n\n    let stream = this.getBundleStream();\n    if (!stream) return;\n\n    let blocks = this.roomBlockOffsets[num];\n    if (!blocks) return;\n\n    stream.seek(blocks['RMIM'].offset + 8);\n\n    let block = this.readBlockHead(stream);\n    let numzbuf = stream.getUint16LE();\n\n    console.log(block.name, block.size, numzbuf);\n\n    if (block.name == 'RMIH') {\n      let block = this.readBlockHead(stream);\n\n      if (block.name == 'IM00') {\n        let block = this.readBlockHead(stream);\n\n        if (block.name == 'SMAP') {\n          for (var i = 0; i < room.width / 8; i++) {\n            let offs = stream.getUint32LE();\n            console.log(i, offs);\n          }\n        }\n      }\n    }\n  }\n\n  parseRoom(num) {\n    let stream = this.getBundleStream();\n    let offset = this.roomOffsets[num];\n\n    stream.seek(offset);\n\n    let block = this.readBlockHead(stream);\n\n    let end = offset + block.size;\n\n    let blocks = {};\n\n    while (stream.offset < end) {\n      let block = this.readBlockHead(stream);\n\n      let info = {\n        name: block.name,\n        size: block.size,\n        offset: stream.offset - 8\n      };\n\n      if (blocks[block.name]) {\n        if (blocks[block.name] instanceof Array) {\n          blocks[block.name].push(info);\n        } else {\n          blocks[block.name] = [ blocks[block.name], info ];\n        }\n      } else {\n        blocks[block.name] = info;\n      }\n\n      stream.getBytes(block.size - 8);\n    }\n\n    this.roomBlockOffsets[num] = blocks;\n\n    stream.seek(blocks['RMHD'].offset + 8);\n    let width = stream.getUint16LE();\n    let height = stream.getUint16LE();\n    let numObjects = stream.getUint16LE();\n\n    this.rooms[num] = new Room({ width: width, height: height, numObjects: numObjects });\n\n    console.log(num, width, height, numObjects);\n\n    this.parseRoomImage(num);\n  }\n\n  parseBundle(num) {\n    let stream = this.getBundleStream();\n\n    // let type = stream.getUint32LE();\n    // let size = stream.getUint32();\n    // let name = this.getBlockTypeName(type);\n    let block = this.readBlockHead(stream);\n\n    console.log(block);\n\n    let offset = 8;\n\n    if (block.name == 'LECF') {\n      let block = this.readBlockHead(stream);\n\n      if (block.name == 'LOFF') {\n        let numrooms = stream.getUint8();\n        for (var i = 0; i < numrooms; i++) {\n          let room = stream.getUint8();\n          let offs = stream.getUint32LE();\n          this.roomOffsets[room] = offs;\n        }\n      }\n    }\n  }\n\n  onFileLoaded(filename) {\n    console.log('Loaded', filename, this.files[filename].byteLength);\n\n    if (filename == 'monkey2.000') {\n      this.files[filename] = this.decode(this.files[filename], 0x69);\n      this.parseIndex();\n    }\n    else if (filename == 'monkey2.001') {\n      this.files[filename] = this.decode(this.files[filename], 0x69);\n      this.parseBundle(filename);\n      this.parseRoom(2);\n    }\n  }\n\n  loadFile(file) {\n    var reader = new FileReader();\n    var filename = file.name.toLowerCase();\n\t\treader.onload = (event) => {\n      // console.log(event.target);\n      this.files[filename] = event.target.result;\n      this.onFileLoaded(filename);\n\t\t};\n\t  reader.readAsArrayBuffer(file);\n  }\n\n  onDrop(event) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    var files = event.dataTransfer.files;\n    for (var i = 0; i < files.length; i++) {\n      this.loadFile(files[i]);\n    }\n  }\n\n  onDragEnter(event) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  onDragOver(event) {\n    event.stopPropagation();\n    event.preventDefault();\n  }\n\n  handleEvent(event) {\n    if (event.type == 'drop') {\n      this.onDrop(event);\n    }\n    else if (event.type == 'dragover') {\n      this.onDragOver(event);\n    }\n    else if (event.type == 'dragenter') {\n      this.onDragEnter(event);\n    }\n  }\n\n}\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  var app = new App();\n  window.addEventListener('drop', app, false);\n  window.addEventListener('dragenter', app, false);\n  window.addEventListener('dragover', app, false);\n});\n","\nclass Bitmap {\n  constructor(params) {\n    this.width = params.width;\n    this.height = params.height;\n    this.pixels = params.pixels;\n  }\n}\n\nmodule.exports = Bitmap;\n","\nclass BufferStream {\n  constructor(buffer) {\n    this.buffer = buffer;\n    this.view = new DataView(this.buffer);\n    this.offset = 0;\n  }\n\n  get length() {\n    return this.buffer.byteLength;\n  }\n\n  seek(offset=0) {\n    this.offset = offset;\n  }\n\n  getUint8(offset) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset++;\n    }\n    return this.view.getUint8(offset);\n  }\n\n  getUint16(offset, littleEndian=false) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += 2;\n    }\n    return this.view.getUint16(offset, littleEndian);\n  }\n\n  getUint32(offset, littleEndian=false) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += 4;\n    }\n    return this.view.getUint32(offset, littleEndian);\n  }\n\n  getUint16LE(offset) {\n    return this.getUint16(offset, true);\n  }\n\n  getUint32LE(offset) {\n    return this.getUint32(offset, true);\n  }\n\n  getBytes(length=1, offset) {\n    if (offset == undefined) {\n      offset = this.offset;\n      this.offset += length;\n    }\n    let bytes = new Uint8Array(length);\n    for (var i = 0; i < length; i++) {\n      bytes[i] = this.view.getUint8(offset + i); //this.getUint8(offset + i);\n    }\n    return bytes;\n  }\n}\n\nmodule.exports = BufferStream;\n","const Bitmap = require('./bitmap');\n\nclass Room {\n  constructor(params) {\n    this.width = params.width;\n    this.height = params.height;\n    this.numObjects = params.numObjects;\n  }\n}\n\nmodule.exports = Room;\n","\nclass Scumm {\n  constructor() {\n    \n  }\n}\n\nmodule.exports = Scumm;\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLmpzIiwic3JjL2JpdG1hcC5qcyIsInNyYy9idWZmZXJfc3RyZWFtLmpzIiwic3JjL3Jvb20uanMiLCJzcmMvc2N1bW0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxNQUFNLFFBQVEsUUFBUSxTQUFSLENBQWQ7QUFDQSxNQUFNLFNBQVMsUUFBUSxVQUFSLENBQWY7QUFDQSxNQUFNLE9BQU8sUUFBUSxRQUFSLENBQWI7QUFDQSxNQUFNLGVBQWUsUUFBUSxpQkFBUixDQUFyQjs7QUFFQSxNQUFNLEdBQU4sQ0FBVTtBQUNSLGdCQUFjO0FBQ1osWUFBUSxHQUFSLENBQVksS0FBWjtBQUNBLFNBQUssS0FBTCxHQUFhLEVBQWI7QUFDQSxTQUFLLFNBQUwsR0FBaUIsRUFBakI7QUFDQSxTQUFLLFdBQUwsR0FBbUIsRUFBbkI7QUFDQSxTQUFLLGdCQUFMLEdBQXdCLEVBQXhCO0FBQ0EsU0FBSyxLQUFMLEdBQWEsRUFBYjtBQUNEOztBQUVELFNBQU8sTUFBUCxFQUFlLE1BQUksQ0FBbkIsRUFBc0I7QUFDcEIsUUFBSSxPQUFPLElBQUksVUFBSixDQUFlLE1BQWYsQ0FBWDtBQUNBLFNBQUssSUFBSSxJQUFJLENBQWIsRUFBZ0IsSUFBSSxLQUFLLE1BQXpCLEVBQWlDLEdBQWpDLEVBQXNDO0FBQ3BDLFdBQUssQ0FBTCxJQUFVLEtBQUssQ0FBTCxJQUFVLEdBQXBCO0FBQ0Q7QUFDRCxXQUFPLEtBQUssTUFBWjtBQUNEOztBQUVELG1CQUFpQixNQUFqQixFQUF5QjtBQUN2QixXQUFPLE9BQU8sWUFBUCxDQUNKLFNBQVMsSUFETCxFQUVILFVBQVUsQ0FBWCxHQUFnQixJQUZaLEVBR0gsVUFBVSxFQUFYLEdBQWlCLElBSGIsRUFJSCxVQUFVLEVBQVgsR0FBaUIsSUFKYixDQUFQO0FBTUQ7O0FBRUQsa0JBQWdCLE1BQWhCLEVBQXdCLE1BQXhCLEVBQWdDO0FBQzlCLFFB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QUFmO0FBQ0Q7QUFDRCxRQUFJLFFBQVEsSUFBSSxVQUFKLENBQWUsTUFBZixDQUFaO0FBQ0EsU0FBSyxJQUFJLElBQUksQ0FBYixFQUFnQixJQUFJLE1BQXBCLEVBQTRCLEdBQTVCLEVBQWlDO0FBQy9CLFlBQU0sQ0FBTixJQUFXLEtBQUssSUFBTCxDQUFVLFFBQVYsQ0FBbUIsU0FBUyxDQUE1QixDQUFYLENBRCtCLENBQ1k7QUFDNUM7QUFDRCxXQUFPLEtBQVA7QUFDRDtBQXpEZ0I7O0FBNERuQixPQUFPLE9BQVAsR0FBaUIsWUFBakI7OztBQzdEQSxNQUFNLFNBQVMsUUFBUSxVQUFSLENBQWY7O0FBRUEsTUFBTSxJQUFOLENBQVc7QUFDVCxjQUFZLE1BQVosRUFBb0I7QUFDbEIsU0FBSyxLQUFMLEdBQWEsT0FBTyxLQUFwQjtBQUNBLFNBQUssTUFBTCxHQUFjLE9BQU8sTUFBckI7QUFDQSxTQUFLLFVBQUwsR0FBa0IsT0FBTyxVQUF6QjtBQUNEO0FBTFE7O0FBUVgsT0FBTyxPQUFQLEdBQWlCLElBQWpCOzs7O0FDVEEsTUFBTSxLQUFOLENBQVk7QUFDVixnQkFBYyxDQUViO0FBSFM7O0FBTVosT0FBTyxPQUFQLEdBQWlCLEtBQWpCIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc31yZXR1cm4gZX0pKCkiLCJjb25zdCBTY3VtbSA9IHJlcXVpcmUoJy4vc2N1bW0nKTtcbmNvbnN0IEJpdG1hcCA9IHJlcXVpcmUoJy4vYml0bWFwJyk7XG5jb25zdCBSb29tID0gcmVxdWlyZSgnLi9yb29tJyk7XG5jb25zdCBCdWZmZXJTdHJlYW0gPSByZXF1aXJlKCcuL2J1ZmZlcl9zdHJlYW0nKTtcblxuY2xhc3MgQXBwIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgY29uc29sZS5sb2coJ0FwcCcpO1xuICAgIHRoaXMuZmlsZXMgPSBbXTtcbiAgICB0aGlzLnJvb21OYW1lcyA9IFtdO1xuICAgIHRoaXMucm9vbU9mZnNldHMgPSBbXTtcbiAgICB0aGlzLnJvb21CbG9ja09mZnNldHMgPSBbXTtcbiAgICB0aGlzLnJvb21zID0gW107XG4gIH1cblxuICBkZWNvZGUoYnVmZmVyLCBlbmM9MCkge1xuICAgIGxldCB0ZW1wID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRlbXAubGVuZ3RoOyBpKyspIHtcbiAgICAgIHRlbXBbaV0gPSB0ZW1wW2ldIF4gZW5jO1xuICAgIH1cbiAgICByZXR1cm4gdGVtcC5idWZmZXI7XG4gIH1cblxuICBnZXRCbG9ja1R5cGVOYW1lKHVpbnQzMikge1xuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKFxuICAgICAgKHVpbnQzMiAmIDB4ZmYpLFxuICAgICAgKCh1aW50MzIgPj4gOCkgJiAweGZmKSxcbiAgICAgICgodWludDMyID4+IDE2KSAmIDB4ZmYpLFxuICAgICAgKCh1aW50MzIgPj4gMjQpICYgMHhmZilcbiAgICApO1xuICB9XG5cbiAgcGFyc2VJbmRleEJsb2NrKHN0cmVhbSwgb2Zmc2V0KSB7XG4gICAgbGV0IHR5cGUgPSBzdHJlYW0uZ2V0VWludDMyTEUoKTtcbiAgICBsZXQgc2l6ZSA9IHN0cmVhbS5nZXRVaW50MzIoKTtcblxuICAgIGxldCBuYW1lID0gdGhpcy5nZXRCbG9ja1R5cGVOYW1lKHR5cGUpO1xuICAgIGNvbnNvbGUubG9nKG5hbWUsIHNpemUpO1xuXG4gICAgaWYgKG5hbWUgPT0gJ1JOQU0nKSB7XG4gICAgICB3aGlsZSAoMSkge1xuICAgICAgICBsZXQgcm9vbW5vID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgIGlmIChyb29tbm8gPT0gMCkgYnJlYWs7XG5cbiAgICAgICAgbGV0IGJ5dGVzID0gc3RyZWFtLmdldEJ5dGVzKDkpO1xuICAgICAgICB0aGlzLnJvb21OYW1lc1tyb29tbm9dID0gYnl0ZXMucmVkdWNlKChhY2N1bXVsYXRvciwgY3VycmVudFZhbHVlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yICsgKGN1cnJlbnRWYWx1ZSAhPSAweGZmID8gU3RyaW5nLmZyb21DaGFyQ29kZShjdXJyZW50VmFsdWUgXiAweGZmKSA6ICcnKTtcbiAgICAgICAgfSwgJycpO1xuICAgICAgICAvLyBvZmZzZXQgKz0gMTA7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyh0aGlzLnJvb21OYW1lcyk7XG4gICAgfVxuICAgIC8vIGVsc2UgaWYgKG5hbWUgPT0gJ0RST08nKSB7XG4gICAgLy8gICBsZXQgbnVtaXRlbXMgPSBzdHJlYW0uZ2V0VWludDE2TEUoKTtcbiAgICAvLyAgIGxldCByb29tTm9zID0gc3RyZWFtLmdldEJ5dGVzKCwgbnVtaXRlbXMpO1xuICAgIC8vXG4gICAgLy8gICBsZXQgcm9vbU9mZnNldHMgPSBbXTtcbiAgICAvLyAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtaXRlbXM7IGkrKykge1xuICAgIC8vICAgICBsZXQgb2ZmcyA9IHN0cmVhbS5nZXRVaW50MzJMRSgpO1xuICAgIC8vICAgICByb29tT2Zmc2V0c1tpXSA9IG9mZnM7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIGVsc2Uge1xuICAgICAgc3RyZWFtLmdldEJ5dGVzKHNpemUgLSA4KTtcbiAgICB9XG5cbiAgfVxuXG4gIHBhcnNlSW5kZXgoKSB7XG4gICAgaWYgKCF0aGlzLmZpbGVzWydtb25rZXkyLjAwMCddKSByZXR1cm47XG5cbiAgICBsZXQgc3RyZWFtID0gbmV3IEJ1ZmZlclN0cmVhbSh0aGlzLmZpbGVzWydtb25rZXkyLjAwMCddKTtcblxuICAgIGxldCBvZmZzZXQgPSAwO1xuXG4gICAgd2hpbGUgKG9mZnNldCA8IHN0cmVhbS5sZW5ndGgpIHtcbiAgICAgIGxldCBibG9ja3NpemUgPSBzdHJlYW0uZ2V0VWludDMyKG9mZnNldCArIDQpO1xuICAgICAgdGhpcy5wYXJzZUluZGV4QmxvY2soc3RyZWFtLCBvZmZzZXQpO1xuICAgICAgb2Zmc2V0ICs9IGJsb2Nrc2l6ZTtcbiAgICB9XG4gIH1cblxuICBnZXRCdW5kbGVTdHJlYW0oKSB7XG4gICAgbGV0IGZpbGVuYW1lID0gJ21vbmtleTIuMDAxJztcbiAgICBpZiAoIXRoaXMuZmlsZXNbZmlsZW5hbWVdKSByZXR1cm47XG4gICAgbGV0IHN0cmVhbSA9IG5ldyBCdWZmZXJTdHJlYW0odGhpcy5maWxlc1tmaWxlbmFtZV0pO1xuICAgIHJldHVybiBzdHJlYW07XG4gIH1cblxuICByZWFkQmxvY2tIZWFkKHN0cmVhbSkge1xuICAgIGxldCB0eXBlID0gc3RyZWFtLmdldFVpbnQzMkxFKCk7XG4gICAgbGV0IHNpemUgPSBzdHJlYW0uZ2V0VWludDMyKCk7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmdldEJsb2NrVHlwZU5hbWUodHlwZSk7XG4gICAgcmV0dXJuIHsgbmFtZTogbmFtZSwgdHlwZTogdHlwZSwgc2l6ZTogc2l6ZSB9O1xuICB9XG5cbiAgcGFyc2VSb29tSW1hZ2UobnVtKSB7XG4gICAgbGV0IHJvb20gPSB0aGlzLnJvb21zW251bV07XG4gICAgaWYgKCFyb29tKSByZXR1cm47XG5cbiAgICBsZXQgc3RyZWFtID0gdGhpcy5nZXRCdW5kbGVTdHJlYW0oKTtcbiAgICBpZiAoIXN0cmVhbSkgcmV0dXJuO1xuXG4gICAgbGV0IGJsb2NrcyA9IHRoaXMucm9vbUJsb2NrT2Zmc2V0c1tudW1dO1xuICAgIGlmICghYmxvY2tzKSByZXR1cm47XG5cbiAgICBzdHJlYW0uc2VlayhibG9ja3NbJ1JNSU0nXS5vZmZzZXQgKyA4KTtcblxuICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuICAgIGxldCBudW16YnVmID0gc3RyZWFtLmdldFVpbnQxNkxFKCk7XG5cbiAgICBjb25zb2xlLmxvZyhibG9jay5uYW1lLCBibG9jay5zaXplLCBudW16YnVmKTtcblxuICAgIGlmIChibG9jay5uYW1lID09ICdSTUlIJykge1xuICAgICAgbGV0IGJsb2NrID0gdGhpcy5yZWFkQmxvY2tIZWFkKHN0cmVhbSk7XG5cbiAgICAgIGlmIChibG9jay5uYW1lID09ICdJTTAwJykge1xuICAgICAgICBsZXQgYmxvY2sgPSB0aGlzLnJlYWRCbG9ja0hlYWQoc3RyZWFtKTtcblxuICAgICAgICBpZiAoYmxvY2submFtZSA9PSAnU01BUCcpIHtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvb20ud2lkdGggLyA4OyBpKyspIHtcbiAgICAgICAgICAgIGxldCBvZmZzID0gc3RyZWFtLmdldFVpbnQzMkxFKCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpLCBvZmZzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwYXJzZVJvb20obnVtKSB7XG4gICAgbGV0IHN0cmVhbSA9IHRoaXMuZ2V0QnVuZGxlU3RyZWFtKCk7XG4gICAgbGV0IG9mZnNldCA9IHRoaXMucm9vbU9mZnNldHNbbnVtXTtcblxuICAgIHN0cmVhbS5zZWVrKG9mZnNldCk7XG5cbiAgICBsZXQgYmxvY2sgPSB0aGlzLnJlYWRCbG9ja0hlYWQoc3RyZWFtKTtcblxuICAgIGxldCBlbmQgPSBvZmZzZXQgKyBibG9jay5zaXplO1xuXG4gICAgbGV0IGJsb2NrcyA9IHt9O1xuXG4gICAgd2hpbGUgKHN0cmVhbS5vZmZzZXQgPCBlbmQpIHtcbiAgICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuXG4gICAgICBsZXQgaW5mbyA9IHtcbiAgICAgICAgbmFtZTogYmxvY2submFtZSxcbiAgICAgICAgc2l6ZTogYmxvY2suc2l6ZSxcbiAgICAgICAgb2Zmc2V0OiBzdHJlYW0ub2Zmc2V0IC0gOFxuICAgICAgfTtcblxuICAgICAgaWYgKGJsb2Nrc1tibG9jay5uYW1lXSkge1xuICAgICAgICBpZiAoYmxvY2tzW2Jsb2NrLm5hbWVdIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBibG9ja3NbYmxvY2submFtZV0ucHVzaChpbmZvKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBibG9ja3NbYmxvY2submFtZV0gPSBbIGJsb2Nrc1tibG9jay5uYW1lXSwgaW5mbyBdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBibG9ja3NbYmxvY2submFtZV0gPSBpbmZvO1xuICAgICAgfVxuXG4gICAgICBzdHJlYW0uZ2V0Qnl0ZXMoYmxvY2suc2l6ZSAtIDgpO1xuICAgIH1cblxuICAgIHRoaXMucm9vbUJsb2NrT2Zmc2V0c1tudW1dID0gYmxvY2tzO1xuXG4gICAgc3RyZWFtLnNlZWsoYmxvY2tzWydSTUhEJ10ub2Zmc2V0ICsgOCk7XG4gICAgbGV0IHdpZHRoID0gc3RyZWFtLmdldFVpbnQxNkxFKCk7XG4gICAgbGV0IGhlaWdodCA9IHN0cmVhbS5nZXRVaW50MTZMRSgpO1xuICAgIGxldCBudW1PYmplY3RzID0gc3RyZWFtLmdldFVpbnQxNkxFKCk7XG5cbiAgICB0aGlzLnJvb21zW251bV0gPSBuZXcgUm9vbSh7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIG51bU9iamVjdHM6IG51bU9iamVjdHMgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhudW0sIHdpZHRoLCBoZWlnaHQsIG51bU9iamVjdHMpO1xuXG4gICAgdGhpcy5wYXJzZVJvb21JbWFnZShudW0pO1xuICB9XG5cbiAgcGFyc2VCdW5kbGUobnVtKSB7XG4gICAgbGV0IHN0cmVhbSA9IHRoaXMuZ2V0QnVuZGxlU3RyZWFtKCk7XG5cbiAgICAvLyBsZXQgdHlwZSA9IHN0cmVhbS5nZXRVaW50MzJMRSgpO1xuICAgIC8vIGxldCBzaXplID0gc3RyZWFtLmdldFVpbnQzMigpO1xuICAgIC8vIGxldCBuYW1lID0gdGhpcy5nZXRCbG9ja1R5cGVOYW1lKHR5cGUpO1xuICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuXG4gICAgY29uc29sZS5sb2coYmxvY2spO1xuXG4gICAgbGV0IG9mZnNldCA9IDg7XG5cbiAgICBpZiAoYmxvY2submFtZSA9PSAnTEVDRicpIHtcbiAgICAgIGxldCBibG9jayA9IHRoaXMucmVhZEJsb2NrSGVhZChzdHJlYW0pO1xuXG4gICAgICBpZiAoYmxvY2submFtZSA9PSAnTE9GRicpIHtcbiAgICAgICAgbGV0IG51bXJvb21zID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtcm9vbXM7IGkrKykge1xuICAgICAgICAgIGxldCByb29tID0gc3RyZWFtLmdldFVpbnQ4KCk7XG4gICAgICAgICAgbGV0IG9mZnMgPSBzdHJlYW0uZ2V0VWludDMyTEUoKTtcbiAgICAgICAgICB0aGlzLnJvb21PZmZzZXRzW3Jvb21dID0gb2ZmcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG9uRmlsZUxvYWRlZChmaWxlbmFtZSkge1xuICAgIGNvbnNvbGUubG9nKCdMb2FkZWQnLCBmaWxlbmFtZSwgdGhpcy5maWxlc1tmaWxlbmFtZV0uYnl0ZUxlbmd0aCk7XG5cbiAgICBpZiAoZmlsZW5hbWUgPT0gJ21vbmtleTIuMDAwJykge1xuICAgICAgdGhpcy5maWxlc1tmaWxlbmFtZV0gPSB0aGlzLmRlY29kZSh0aGlzLmZpbGVzW2ZpbGVuYW1lXSwgMHg2OSk7XG4gICAgICB0aGlzLnBhcnNlSW5kZXgoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZmlsZW5hbWUgPT0gJ21vbmtleTIuMDAxJykge1xuICAgICAgdGhpcy5maWxlc1tmaWxlbmFtZV0gPSB0aGlzLmRlY29kZSh0aGlzLmZpbGVzW2ZpbGVuYW1lXSwgMHg2OSk7XG4gICAgICB0aGlzLnBhcnNlQnVuZGxlKGZpbGVuYW1lKTtcbiAgICAgIHRoaXMucGFyc2VSb29tKDIpO1xuICAgIH1cbiAgfVxuXG4gIGxvYWRGaWxlKGZpbGUpIHtcbiAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICB2YXIgZmlsZW5hbWUgPSBmaWxlLm5hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRyZWFkZXIub25sb2FkID0gKGV2ZW50KSA9PiB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhldmVudC50YXJnZXQpO1xuICAgICAgdGhpcy5maWxlc1tmaWxlbmFtZV0gPSBldmVudC50YXJnZXQucmVzdWx0O1xuICAgICAgdGhpcy5vbkZpbGVMb2FkZWQoZmlsZW5hbWUpO1xuXHRcdH07XG5cdCAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpO1xuICB9XG5cbiAgb25Ecm9wKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHZhciBmaWxlcyA9IGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmxvYWRGaWxlKGZpbGVzW2ldKTtcbiAgICB9XG4gIH1cblxuICBvbkRyYWdFbnRlcihldmVudCkge1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cblxuICBvbkRyYWdPdmVyKGV2ZW50KSB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIGhhbmRsZUV2ZW50KGV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnR5cGUgPT0gJ2Ryb3AnKSB7XG4gICAgICB0aGlzLm9uRHJvcChldmVudCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGV2ZW50LnR5cGUgPT0gJ2RyYWdvdmVyJykge1xuICAgICAgdGhpcy5vbkRyYWdPdmVyKGV2ZW50KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZXZlbnQudHlwZSA9PSAnZHJhZ2VudGVyJykge1xuICAgICAgdGhpcy5vbkRyYWdFbnRlcihldmVudCk7XG4gICAgfVxuICB9XG5cbn1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gIHZhciBhcHAgPSBuZXcgQXBwKCk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgYXBwLCBmYWxzZSk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW50ZXInLCBhcHAsIGZhbHNlKTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgYXBwLCBmYWxzZSk7XG59KTtcbiIsIlxuY2xhc3MgQml0bWFwIHtcbiAgY29uc3RydWN0b3IocGFyYW1zKSB7XG4gICAgdGhpcy53aWR0aCA9IHBhcmFtcy53aWR0aDtcbiAgICB0aGlzLmhlaWdodCA9IHBhcmFtcy5oZWlnaHQ7XG4gICAgdGhpcy5waXhlbHMgPSBwYXJhbXMucGl4ZWxzO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQml0bWFwO1xuIiwiXG5jbGFzcyBCdWZmZXJTdHJlYW0ge1xuICBjb25zdHJ1Y3RvcihidWZmZXIpIHtcbiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlcjtcbiAgICB0aGlzLnZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIpO1xuICAgIHRoaXMub2Zmc2V0ID0gMDtcbiAgfVxuXG4gIGdldCBsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGg7XG4gIH1cblxuICBzZWVrKG9mZnNldD0wKSB7XG4gICAgdGhpcy5vZmZzZXQgPSBvZmZzZXQ7XG4gIH1cblxuICBnZXRVaW50OChvZmZzZXQpIHtcbiAgICBpZiAob2Zmc2V0ID09IHVuZGVmaW5lZCkge1xuICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQ7XG4gICAgICB0aGlzLm9mZnNldCsrO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQ4KG9mZnNldCk7XG4gIH1cblxuICBnZXRVaW50MTYob2Zmc2V0LCBsaXR0bGVFbmRpYW49ZmFsc2UpIHtcbiAgICBpZiAob2Zmc2V0ID09IHVuZGVmaW5lZCkge1xuICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQ7XG4gICAgICB0aGlzLm9mZnNldCArPSAyO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQxNihvZmZzZXQsIGxpdHRsZUVuZGlhbik7XG4gIH1cblxuICBnZXRVaW50MzIob2Zmc2V0LCBsaXR0bGVFbmRpYW49ZmFsc2UpIHtcbiAgICBpZiAob2Zmc2V0ID09IHVuZGVmaW5lZCkge1xuICAgICAgb2Zmc2V0ID0gdGhpcy5vZmZzZXQ7XG4gICAgICB0aGlzLm9mZnNldCArPSA0O1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy52aWV3LmdldFVpbnQzMihvZmZzZXQsIGxpdHRsZUVuZGlhbik7XG4gIH1cblxuICBnZXRVaW50MTZMRShvZmZzZXQpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRVaW50MTYob2Zmc2V0LCB0cnVlKTtcbiAgfVxuXG4gIGdldFVpbnQzMkxFKG9mZnNldCkge1xuICAgIHJldHVybiB0aGlzLmdldFVpbnQzMihvZmZzZXQsIHRydWUpO1xuICB9XG5cbiAgZ2V0Qnl0ZXMobGVuZ3RoPTEsIG9mZnNldCkge1xuICAgIGlmIChvZmZzZXQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICBvZmZzZXQgPSB0aGlzLm9mZnNldDtcbiAgICAgIHRoaXMub2Zmc2V0ICs9IGxlbmd0aDtcbiAgICB9XG4gICAgbGV0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBieXRlc1tpXSA9IHRoaXMudmlldy5nZXRVaW50OChvZmZzZXQgKyBpKTsgLy90aGlzLmdldFVpbnQ4KG9mZnNldCArIGkpO1xuICAgIH1cbiAgICByZXR1cm4gYnl0ZXM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBCdWZmZXJTdHJlYW07XG4iLCJjb25zdCBCaXRtYXAgPSByZXF1aXJlKCcuL2JpdG1hcCcpO1xuXG5jbGFzcyBSb29tIHtcbiAgY29uc3RydWN0b3IocGFyYW1zKSB7XG4gICAgdGhpcy53aWR0aCA9IHBhcmFtcy53aWR0aDtcbiAgICB0aGlzLmhlaWdodCA9IHBhcmFtcy5oZWlnaHQ7XG4gICAgdGhpcy5udW1PYmplY3RzID0gcGFyYW1zLm51bU9iamVjdHM7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBSb29tO1xuIiwiXG5jbGFzcyBTY3VtbSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIFxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU2N1bW07XG4iXX0="}